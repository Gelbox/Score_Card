<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AV Solution Scorecard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" xintegrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      background-color: #212121;
      color: #fff;
      margin: 0;
      padding: 2rem;
    }
    h1, h2 {
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    label {
      display: block;
      margin-bottom: 0.25rem;
      color: #fff;
    }
    select, input {
      display: block;
      margin: 0.5rem 0;
      padding: 0.5rem;
      background-color: #333;
      border: 1px solid #555;
      color: #fff;
      border-radius: 4px;
      width: calc(100% - 1rem);
    }
    input[type="number"] {
        width: 60px;
    }
    /* Main container for side-by-side layout */
    .main-container {
      display: flex;
      gap: 2rem; /* Space between columns */
      flex-wrap: wrap; /* Allow wrapping on smaller screens */
    }

    .form-column {
      flex: 1; /* Takes up available space */
      min-width: 400px; /* Ensure it doesn't get too small */
    }

    .chart-column {
      flex: 0 0 450px; /* Fixed width for the chart column, or adjust as needed */
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    .section {
      margin-bottom: 2rem;
      padding: 1rem;
      background-color: #333;
      border-radius: 8px;
    }
    .result {
      margin-top: 0; /* Adjusted margin for chart column */
      padding: 1rem;
      background-color: #333;
      border-left: 5px solid #00ffcc;
      border-radius: 8px;
    }
    .form-group {
      display: flex;
      align-items: flex-start; /* Changed from flex-end for vertical alignment */
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .sub-category {
        margin-left: 2rem;
    }
    canvas {
        background-color: #333;
        padding: 1rem;
        border-radius: 8px;
        margin-top: 1rem; /* Space between inputs and chart */
        width: 100%; /* Ensure it takes full width of its container */
        height: auto; /* Let aspect ratio handle height */
    }
    .fa-icon {
        color: #fff;
    }
  </style>
</head>
<body>
  <h1><i class="fa-solid fa-square-poll-vertical fa-icon"></i>AV Solution Scorecard</h1>
  <p>Rate each sub-category from 0 (poor) to 5 (excellent), and assign priority weight (1â€“5).</p>

  <div class="main-container">
    <form id="scorecardForm" class="form-column">
      <div class="section">
        <h2><i class="fa-solid fa-shield-halved fa-icon"></i>Security</h2>
        <div class="sub-category form-group">
          <div>
            <label>Credential handling:</label>
            <input type="number" name="security_1_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="security_1_weight" min="1" max="5" required />
          </div>
        </div>
        <div class="sub-category form-group">
          <div>
            <label>Access control:</label>
            <input type="number" name="security_2_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="security_2_weight" min="1" max="5" required />
          </div>
        </div>
        <div class="sub-category form-group">
          <div>
            <label>Encryption support:</label>
            <input type="number" name="security_3_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="security_3_weight" min="1" max="5" required />
          </div>
        </div>
        <div class="sub-category form-group">
          <div>
            <label>Patch management process:</label>
            <input type="number" name="security_4_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="security_4_weight" min="1" max="5" required />
          </div>
        </div>
        <canvas id="securityRadarChart"></canvas>
      </div>

      <div class="section">
        <h2><i class="fa-solid fa-server fa-icon"></i>High Availability</h2>
        <div class="sub-category form-group">
          <div>
            <label>Single points of failure:</label>
            <input type="number" name="ha_1_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="ha_1_weight" min="1" max="5" required />
          </div>
        </div>
        <div class="sub-category form-group">
          <div>
            <label>Failover/redundancy:</label>
            <input type="number" name="ha_2_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="ha_2_weight" min="1" max="5" required />
          </div>
        </div>
        <div class="sub-category form-group">
          <div>
            <label>Power backup:</label>
            <input type="number" name="ha_3_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="ha_3_weight" min="1" max="5" required />
          </div>
        </div>
        <div class="sub-category form-group">
          <div>
            <label>Link/path diversity:</label>
            <input type="number" name="ha_4_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="ha_4_weight" min="1" max="5" required />
          </div>
        </div>
        <canvas id="haRadarChart"></canvas>
      </div>

      <div class="section">
        <h2><i class="fa-solid fa-exchange-alt fa-icon"></i>Interoperability</h2>
        <div class="sub-category form-group">
          <div>
            <label>Standards compliance (AES67, NMOS):</label>
            <input type="number" name="interop_1_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="interop_1_weight" min="1" max="5" required />
          </div>
        </div>
        <div class="sub-category form-group">
          <div>
            <label>Vendor interop:</label>
            <input type="number" name="interop_2_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="interop_2_weight" min="1" max="5" required />
          </div>
        </div>
        <div class="sub-category form-group">
          <div>
            <label>Protocol compatibility:</label>
            <input type="number" name="interop_3_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="interop_3_weight" min="1" max="5" required />
          </div>
        </div>
        <canvas id="interopRadarChart"></canvas>
      </div>

      <div class="section">
        <h2><i class="fa-solid fa-eye fa-icon"></i>Observability</h2>
        <div class="sub-category form-group">
          <div>
            <label>Logging:</label>
            <input type="number" name="observability_1_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="observability_1_weight" min="1" max="5" required />
          </div>
        </div>
        <div class="sub-category form-group">
          <div>
            <label>SNMP/API support:</label>
            <input type="number" name="observability_2_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="observability_2_weight" min="1" max="5" required />
          </div>
        </div>
        <div class="sub-category form-group">
          <div>
            <label>Metrics collection:</label>
            <input type="number" name="observability_3_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="observability_3_weight" min="1" max="5" required />
          </div>
        </div>
        <div class="sub-category form-group">
          <div>
            <label>Alerts & monitoring hooks:</label>
            <input type="number" name="observability_4_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="observability_4_weight" min="1" max="5" required />
          </div>
        </div>
        <canvas id="observabilityRadarChart"></canvas>
      </div>

      <div class="section">
        <h2><i class="fa-solid fa-clock-o fa-icon"></i>Clocking & Sync</h2>
        <div class="sub-category form-group">
          <div>
            <label>PTP support:</label>
            <input type="number" name="clocking_1_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="clocking_1_weight" min="1" max="5" required />
          </div>
        </div>
        <div class="sub-category form-group">
          <div>
            <label>Clock stability:</label>
            <input type="number" name="clocking_2_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="clocking_2_weight" min="1" max="5" required />
          </div>
        </div>
        <div class="sub-category form-group">
          <div>
            <label>Recovery behavior:</label>
            <input type="number" name="clocking_3_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="clocking_3_weight" min="1" max="5" required />
          </div>
        </div>
        <canvas id="clockingRadarChart"></canvas>
      </div>

      <div class="section">
        <h2><i class="fa-solid fa-network-wired fa-icon"></i>Network Readiness</h2>
        <div class="sub-category form-group">
          <div>
            <label>Multicast handling:</label>
            <input type="number" name="network_1_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="network_1_weight" min="1" max="5" required />
          </div>
        </div>
        <div class="sub-category form-group">
          <div>
            <label>QoS/DSCP marking:</label>
            <input type="number" name="network_2_score" min="0" max="5" required />
          </div>
          <div>
            <label>Weight:</label>
            <input type="number" name="network_2_weight" min="1" max="5" required />
          </div>
        </div>
        <div class="sub-category form-group">
          <div>
            <label>VLAN compatibility:</label>
          <input type="number" name="network_3_score" min="0" max="5" required />
        </div>
        <div>
          <label>Weight:</label>
          <input type="number" name="network_3_weight" min="1" max="5" required />
        </div>
      </div>
      <div class="sub-category form-group">
        <div>
          <label>IGMP/MDNS/DNS:</label>
          <input type="number" name="network_4_score" min="0" max="5" required />
        </div>
        <div>
          <label>Weight:</label>
          <input type="number" name="network_4_weight" min="1" max="5" required />
        </div>
      </div>
      <canvas id="networkRadarChart"></canvas>
    </div>
  </form>

  <div class="chart-column">
    <div class="result" id="result" style="display:none">
      <h2><i class="fa-solid fa-calculator fa-icon"></i>Overall Score</h2>
      <p id="scoreOutput"></p>
    </div>
    
    <div class="section" id="chartSection" style="display:none">
      <h2><i class="fa-solid fa-chart-line fa-icon"></i>Aggregate Score Visualization</h2>
      <canvas id="radarChart"></canvas>
    </div>
  </div>
  </div>

  <script>
    const categoryDefinitions = [
      {
        id: 'security',
        label: 'Security',
        icon: 'fa-shield-halved',
        subCategories: [
          { key: 'security_1', label: 'Credential handling' },
          { key: 'security_2', label: 'Access control' },
          { key: 'security_3', label: 'Encryption support' },
          { key: 'security_4', label: 'Patch management process' }
        ]
      },
      {
        id: 'ha',
        label: 'High Availability',
        icon: 'fa-server',
        subCategories: [
          { key: 'ha_1', label: 'Single points of failure' },
          { key: 'ha_2', label: 'Failover/redundancy' },
          { key: 'ha_3', label: 'Power backup' },
          { key: 'ha_4', label: 'Link/path diversity' }
        ]
      },
      {
        id: 'interop',
        label: 'Interoperability',
        icon: 'fa-exchange-alt',
        subCategories: [
          { key: 'interop_1', label: 'Standards compliance' },
          { key: 'interop_2', label: 'Vendor interop' },
          { key: 'interop_3', label: 'Protocol compatibility' }
        ]
      },
      {
        id: 'observability',
        label: 'Observability',
        icon: 'fa-eye',
        subCategories: [
          { key: 'observability_1', label: 'Logging' },
          { key: 'observability_2', label: 'SNMP/API support' },
          { key: 'observability_3', label: 'Metrics collection' },
          { key: 'observability_4', label: 'Alerts & monitoring hooks' }
        ]
      },
      {
        id: 'clocking',
        label: 'Clocking & Sync',
        icon: 'fa-clock-o',
        subCategories: [
          { key: 'clocking_1', label: 'PTP support' },
          { key: 'clocking_2', label: 'Clock stability' },
          { key: 'clocking_3', label: 'Recovery behavior' }
        ]
      },
      {
        id: 'network',
        label: 'Network Readiness',
        icon: 'fa-network-wired',
        subCategories: [
          { key: 'network_1', label: 'Multicast handling' },
          { key: 'network_2', label: 'QoS/DSCP marking' },
          { key: 'network_3', label: 'VLAN compatibility' },
          { key: 'network_4', label: 'IGMP/MDNS/DNS' }
        ]
      }
    ];

    let aggregateRadarChart = null;
    const categoryRadarCharts = {}; // Object to store individual category chart instances

    // Helper function to create or update a Chart.js radar chart
    function createOrUpdateChart(canvasId, labels, data, chartInstance) {
      const ctx = document.getElementById(canvasId);
      if (!ctx) return null; // Ensure canvas exists

      const chartData = {
        labels: labels,
        datasets: [{
          label: 'Score',
          data: data,
          backgroundColor: 'rgba(255, 255, 255, 0.2)', /* White with transparency */
          borderColor: '#fff', /* White border */
          borderWidth: 2,
          pointBackgroundColor: '#fff', /* White points */
          pointBorderColor: '#fff',
          pointBorderWidth: 1,
          pointRadius: 5
        }]
      };

      const chartOptions = {
        responsive: true,
        maintainAspectRatio: true, 
        scales: {
          r: {
            angleLines: { color: 'rgba(255, 255, 255, 0.3)' },
            grid: { color: 'rgba(255, 255, 255, 0.3)' },
            pointLabels: { color: '#fff', font: { size: 12 } },
            ticks: {
              beginAtZero: true,
              max: 5,
              stepSize: 1,
              backdropColor: 'transparent',
              color: '#fff'
            }
          }
        },
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: function(context) {
                let label = context.dataset.label || '';
                if (label) {
                  label += ': ';
                }
                if (context.parsed.r !== null) {
                  label += context.parsed.r;
                }
                return label;
              }
            }
          }
        }
      };

      if (chartInstance) {
        chartInstance.data = chartData;
        chartInstance.update();
        return chartInstance;
      } else {
        return new Chart(ctx, {
          type: 'radar',
          data: chartData,
          options: chartOptions
        });
      }
    }

    function updateScorecard() {
      let totalWeightedScore = 0;
      let totalWeight = 0;
      let allInputsFilled = true;

      const aggregateCategoryScores = [];
      const aggregateCategoryLabels = [];

      categoryDefinitions.forEach(mainCategory => {
        let categorySubScores = [];
        let categorySubLabels = [];
        let categoryWeightedScore = 0;
        let categoryWeight = 0;
        let categoryHasValidInputs = false; // Track if category has at least one valid input

        mainCategory.subCategories.forEach(subCategory => {
          const scoreInput = document.querySelector(`[name=${subCategory.key}_score]`);
          const weightInput = document.querySelector(`[name=${subCategory.key}_weight]`);
          
          // Clamp score value
          if (scoreInput) {
              let scoreVal = parseFloat(scoreInput.value);
              if (isNaN(scoreVal) || scoreVal < 0) scoreVal = 0;
              if (scoreVal > 5) scoreVal = 5;
              if (scoreInput.value !== scoreVal.toString()) { // Only update if changed to avoid infinite loops
                  scoreInput.value = scoreVal; 
              }
          }

          // Clamp weight value
          if (weightInput) {
              let weightVal = parseFloat(weightInput.value);
              if (isNaN(weightVal) || weightVal < 1) weightVal = 1;
              if (weightVal > 5) weightVal = 5;
              if (weightInput.value !== weightVal.toString()) { // Only update if changed to avoid infinite loops
                  weightInput.value = weightVal; 
              }
          }

          const score = parseFloat(scoreInput ? scoreInput.value : '') || 0;
          const weight = parseFloat(weightInput ? weightInput.value : '') || 0;

          // Only consider inputs that have both score and weight filled
          if (scoreInput.value !== '' && weightInput.value !== '') {
            categoryHasValidInputs = true;
            categorySubScores.push(score);
            categorySubLabels.push(subCategory.label);
            categoryWeightedScore += score * weight;
            categoryWeight += weight;
          } else {
            // If any sub-category input is empty, the overall form is not fully filled
            allInputsFilled = false; 
          }
        });

        // Update individual category chart
        const categoryCanvas = document.getElementById(`${mainCategory.id}RadarChart`);
        if (categoryHasValidInputs && categoryWeight > 0) {
            categoryCanvas.style.display = 'block'; 
            categoryRadarCharts[mainCategory.id] = createOrUpdateChart(
                `${mainCategory.id}RadarChart`,
                categorySubLabels,
                categorySubScores,
                categoryRadarCharts[mainCategory.id]
            );
        } else {
            categoryCanvas.style.display = 'none';
            if (categoryRadarCharts[mainCategory.id]) {
                categoryRadarCharts[mainCategory.id].destroy();
                categoryRadarCharts[mainCategory.id] = null;
            }
        }

        // Prepare data for aggregate chart
        if (categoryHasValidInputs && categoryWeight > 0) { // Only add to aggregate if category has valid inputs
            aggregateCategoryScores.push((categoryWeightedScore / categoryWeight).toFixed(2));
            aggregateCategoryLabels.push(mainCategory.label);
        }
      });

      // Update overall score and aggregate chart
      if (allInputsFilled && totalWeight > 0) {
        const overallScore = (totalWeightedScore / totalWeight).toFixed(2);
        document.getElementById('scoreOutput').textContent = `Weighted Score: ${overallScore} / 5`;
        document.getElementById('result').style.display = 'block';
        document.getElementById('chartSection').style.display = 'block';

        aggregateRadarChart = createOrUpdateChart(
            'radarChart',
            aggregateCategoryLabels,
            aggregateCategoryScores,
            aggregateRadarChart
        );
      } else {
        document.getElementById('result').style.display = 'none';
        document.getElementById('chartSection').style.display = 'none';
        if (aggregateRadarChart) {
            aggregateRadarChart.destroy();
            aggregateRadarChart = null;
        }
      }
    }

    // Set up event listeners for live updates
    const form = document.getElementById('scorecardForm');
    form.addEventListener('input', updateScorecard);

    // Initial call to set up the chart if any values are pre-filled
    updateScorecard();
  </script>
</body>
</html>
